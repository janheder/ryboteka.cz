{"version":3,"file":"../library.js","sources":["library.js"],"sourcesContent":["Packeta = window.Packeta || {};\nPacketa.Viewport = {\n    element: null,\n    originalValue: null,\n    set: function () {\n        if (!Packeta.Viewport.element) {\n            Packeta.Viewport.element = document.querySelector(\"meta[name=viewport]\");\n            if (Packeta.Viewport.element) {\n                Packeta.Viewport.originalValue = Packeta.Viewport.element.getAttribute(\"content\");\n            } else {\n                Packeta.Viewport.originalValue = 'user-scalable=yes';\n                Packeta.Viewport.element = document.createElement('meta');\n                Packeta.Viewport.element.setAttribute(\"name\", \"viewport\");\n                (document.head || document.getElementsByTagName('head')[0]).appendChild(Packeta.Viewport.element);\n            }\n        }\n        Packeta.Viewport.element.setAttribute('content', 'width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes');\n    },\n    restore: function () {\n        if (Packeta.Viewport.originalValue !== null) {\n            Packeta.Viewport.element.setAttribute('content', Packeta.Viewport.originalValue);\n        }\n    }\n};\n\nPacketa.Util = {\n\n    makeRequest: function (method, url, data, callback) {\n        try {\n            var xhr = new XMLHttpRequest();\n            xhr.open(method, url);\n            xhr.timeout = 5000;\n\n            xhr.onload = function () {\n            if (this.status >= 200 && this.status < 300) {\n                callback(xhr.response, false);\n            } else {\n                callback({\n                    status: this.status,\n                    statusText: xhr.statusText\n                }, true);\n            }\n            };\n\n            xhr.onerror = function () {\n                callback({\n                    status: this.status,\n                    statusText: xhr.statusText\n                }, true);\n            };\n    \n            xhr.ontimeout = function () {\n                callback({\n                    status: this.status,\n                    statusText: xhr.statusText\n                }, true);\n            };\n    \n            if (method === \"POST\" && data) {\n                xhr.send(data);\n            } else {\n                xhr.send();\n            }        \n        } catch (error) {\n            callback({\n                error: \"XMLHttpRequest error: \" + error\n            }, true)\n        }\n    }\n  };\n\nPacketa.Widget = {\n    baseUrl: 'https://widget.packeta.com/',\n    healthUrl: 'https://widget.packeta.com/v6/api/hcs/api/healthcheck',\n    // healthUrl: 'https://health-check-svc-uat.box.packeta.codenow.com/api/healthcheck',\n    //healthUrl: 'https://codenow-uat-widget.azureedge.net/api/healthcheck',\n    versions : {\n      v5 : 'v5',\n      v6 : 'v6'\n    },\n    close: function () {\n    },\n    initIframe: function(apiKey, callback, opts, inElement){\n        Packeta.Widget.close();\n\n        if (opts === undefined) {\n            opts = {};\n        }\n        if (!('version' in opts)) {\n            opts.version = 3;\n        }\n\n        opts.apiKey = apiKey;\n\n        var url = Packeta.Widget.baseUrl + 'v6/#/?';\n\n        if (opts.currentVersion === Packeta.Widget.versions.v5){\n            url = Packeta.Widget.baseUrl + 'v5/#/?';\n        }\n\n        for (i in opts) {\n            url += \"&\" + i + \"=\" + encodeURIComponent(opts[i]);\n        }\n\n        var inline = (typeof (inElement) != \"undefined\" && inElement !== null);\n        var wrapper;\n        if (inline) {\n            wrapper = inElement;\n        } else {\n            Packeta.Viewport.set();\n            wrapper = document.createElement(\"div\");\n            wrapper.setAttribute(\"style\", \"z-index: 999999; position: fixed; -webkit-backface-visibility: hidden; left: 0; top: 0; width: 100%; height: 100%; background: \" + (opts.overlayColor || \"rgba(0, 0, 0, 0.3)\") + \"; \");\n            wrapper.addEventListener(\"click\", function () {\n                Packeta.Widget.close();\n            });\n\n            // fix for some older browsers which fail to do 100% width of position:absolute inside position:fixed element\n            setTimeout(\n                function () {\n                    var rect = iframe.getBoundingClientRect();\n                    var width = ('width' in rect ? rect.width : rect.right - rect.left);\n                    if (Math.round(width) < window.innerWidth - 10) { // 10px = side padding sum, just as a safety measure\n                        iframe.style.width = window.innerWidth + \"px\";\n                        iframe.style.height = window.innerHeight + \"px\";\n                    }\n                },\n                0\n            );\n        }\n\n        // always support Escape key immediatelly after the widget is displayed, even for inline\n        wrapper.addEventListener(\"keyup\", function (e) {\n            if (e.keyCode == 27) {\n                Packeta.Widget.close();\n            }\n        });\n\n        var iframe = document.createElement(\"iframe\");\n        if (inline) {\n            iframe.setAttribute(\"style\", \"border: hidden; width: 100%; height: 100%; \");\n        } else {\n            iframe.setAttribute(\"style\", \"border: hidden; position: absolute; left: 0; top: 0; width: 100%; height: 100%; padding: 10px 5px; box-sizing: border-box; \");\n        }\n        iframe.setAttribute('id', \"packeta-widget\");\n        iframe.setAttribute('sandbox', \"allow-scripts allow-same-origin\");\n        iframe.setAttribute('allow', \"geolocation\");\n        iframe.setAttribute('src', url);\n\n        wrapper.appendChild(iframe);\n        if (!inline) {\n            document.body.appendChild(wrapper);\n        }\n\n        if (wrapper.getAttribute(\"tabindex\") === null) {\n            wrapper.setAttribute(\"tabindex\", \"-1\"); // make it focusable\n        }\n        wrapper.focus();\n\n        var receiver = function (e) {\n            // check if this is message from the Packeta Widget\n            try {\n                var message = JSON.parse(e.data);\n                if (!message.packetaWidgetMessage) return;\n            } catch (err) {\n                return;\n            }\n\n            Packeta.Widget.close(message.packetaPoint);\n        };\n        window.addEventListener('message', receiver);\n\n        Packeta.Widget.close = function (point) {\n            window.removeEventListener('message', receiver);\n            if (inline) {\n                try {\n                    iframe.parentNode.removeChild(iframe);\n                } catch (err) {\n                    // ignore\n                }\n            } else {\n                document.body.removeChild(wrapper);\n                Packeta.Viewport.restore();\n            }\n            callback(point || null);\n            Packeta.Widget.close = function () {\n            };\n        };\n    },\n    pick: function (apiKey, callback, opts, inElement) {\n\n        if (opts === undefined) {\n            opts = {};\n        }\n\n        function runV6 () {\n            opts.currentVersion = Packeta.Widget.versions.v6;\n            Packeta.Widget.initIframe(apiKey, callback, opts, inElement);\n        };\n\n        function runV5 () {\n            opts.currentVersion = Packeta.Widget.versions.v5;\n            Packeta.Widget.initIframe(apiKey, callback, opts, inElement);\n        }\n\n\n        Packeta.Util.makeRequest(\"GET\", Packeta.Widget.healthUrl, null, function (data, error) {\n\n            if (!error) {\n\n                var result = data.toLocaleLowerCase() === \"true\";\n\n                console.log(\"v6 widget health check result: \" + result);\n\n                if (result === true){\n                    console.log(\"starting v6\");\n                    runV6();\n                } else {\n                    console.log(\"starting v5\");\n                    runV5();\n                }\n\n            } else {\n                console.log(\"v6 widget health check result: \" + JSON.stringify(data));\n                console.log(\"starting v5\");\n                runV5();\n            }\n        })\n    }\n};"],"names":["Packeta","window","Viewport","element","originalValue","set","document","querySelector","getAttribute","createElement","setAttribute","head","getElementsByTagName","appendChild","restore","Util","makeRequest","method","url","data","callback","xhr","XMLHttpRequest","open","timeout","onload","this","status","response","statusText","onerror","ontimeout","send","error","Widget","baseUrl","healthUrl","versions","v5","v6","close","initIframe","apiKey","opts","inElement","undefined","version","i","currentVersion","encodeURIComponent","wrapper","inline","overlayColor","addEventListener","setTimeout","rect","iframe","getBoundingClientRect","width","right","left","Math","round","innerWidth","style","height","innerHeight","e","keyCode","body","focus","receiver","message","JSON","parse","packetaWidgetMessage","err","packetaPoint","point","removeEventListener","parentNode","removeChild","pick","runV5","console","log","stringify","result","toLocaleLowerCase"],"mappings":"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"}